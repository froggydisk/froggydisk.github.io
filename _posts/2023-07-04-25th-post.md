---
title: "[k8s] ìƒˆë¡œìš´ ì›Œì»¤ë…¸ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ì„œë²„ ì¦ì„¤í•˜ê¸°"

comments: true
categories:
  - Blog
tags:
  - Kubernetes, On-premise
last_modified_at: 2023-07-04T
---

ë§ˆìŠ¤í„° ë…¸ë“œì˜ ì„¤ì •ì´ ì´ë¯¸ ë˜ì–´ ìˆê³  ì¶”ê°€í•  ì›Œì»¤ë…¸ë“œì˜ OSê°€ ìš°ë¶„íˆ¬ 20.04 ë²„ì „ì¸ ê²½ìš°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì„¤ëª…í•˜ê² ë‹¤.

---
---
# ğŸ“– ìš”ì•½
â— docker  
â— kubelet  
â— kubeadm  
â— kubectl  
ìƒˆë¡œìš´ ì›Œì»¤ë…¸ë“œì— ìœ„ 4ê°€ì§€ë¥¼ ì„¤ì¹˜í•´ì¤€ë‹¤.  
ê·¸ë¦¬ê³  ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ í† í°ì„ ë°œê¸‰í•˜ì—¬ ìƒˆë¡œ ì—°ê²°í•  ì›Œì»¤ë…¸ë“œì— ì…ë ¥í•´ì£¼ë©´ ëì´ë‹¤.

---
---


# ğŸ¬ ì§„í–‰
ìƒê°ë³´ë‹¤ ëª¹ì‹œ ê°„ë‹¨í•˜ë‹¤. ì´ì œ í•˜ë‚˜í•˜ë‚˜ ì°¨ê·¼ì°¨ê·¼ ì§„í–‰í•´ë³´ì.

### docker ì„¤ì¹˜
```bash
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io
sudo docker version
sudo systemctl enable docker
sudo systemctl start docker
```

### kubelet, kubeadm, kubectl ì„¤ì¹˜
í•œ ì¤„ì”© ì˜ ì…ë ¥í•´ì¤€ë‹¤.
```bash
sudo apt-get update
sudo apt-get install -y apt-transport-https ca-certificates curl
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
echo "deb http://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee /etc/apt/sources.list.d/kubernetes.list
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
sudo systemctl daemon-reload
sudo systemctl restart kubelet
```

### í† í° ë°œê¸‰ ë° ë“±ë¡
ìš°ì„ , ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ í† í°ì„ ë°œê¸‰í•œë‹¤.
```bash
sudo kubeadm token create --print-join-command
```
ì´ë ‡ê²Œ í•˜ë©´ `kubeadm join <Kubernetes API Server:PORT> --token <Token ê°’> --discovery-token-ca-cert-hash sha256:<Hash ê°’>` ì´ëŸ¬í•œ í˜•íƒœì˜ ê²°ê³¼ê°’ì´ ë‚˜ì˜¤ëŠ”ë° ê·¸ëŒ€ë¡œ ë³µì‚¬í•´ì„œ ìƒˆë¡œìš´ ì›Œì»¤ë…¸ë“œ í„°ë¯¸ë„ì— ë¶™ì—¬ë„£ê¸° í•´ì£¼ë©´ ëœë‹¤.
  
ê°ê°ì˜ ê°’ì€ ë‹¤ìŒê³¼ ê°™ì´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
```bash
# kubectlì´ ë°”ë¼ë³´ëŠ” API ì„œë²„ ì£¼ì†Œ
kubectl cluster-info
# token ê°’ í™•ì¸
kubeadm token list
# hash ê°’ í™•ì¸
openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'
```

### ğŸ”’ ì—ëŸ¬
ìœ„ì˜ ê³¼ì •ì—ì„œ ì•„ë§ˆë„ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•  ê²ƒì´ë‹¤.
```bash
error execution phase preflight: [preflight] Some fatal errors occurred:
[ERROR CRI]: container runtime is not running: output: time="2020-11-25T12:58:32Z" level=fatal msg="getting status of runtime failed: rpc error: code = Unimplemented desc = unknown service runtime.v1alpha2.RuntimeService"
, error: exit status 1
```

### ğŸ”‘ í•´ê²°
ì•„ë˜ì™€ ê°™ì´ í•´ê²°í•˜ë©´ ëœë‹¤.
```bash
sudo rm /etc/containerd/config.toml
sudo systemctl restart containerd
```

í•­ìƒ ëŠë¼ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ì˜¤ë¥˜ëŠ” kubelet, docker, containerd, calico ì´ ë„¤ê°€ì§€ì—ì„œ ìì£¼ ë°œìƒí•˜ëŠ” ê²ƒ ê°™ë‹¤.  
ë§ˆì§€ë§‰ìœ¼ë¡œ ë§ˆìŠ¤í„°ë…¸ë“œì— ë“¤ì–´ê°€ì„œ `kubectl get node`ë¥¼ í•´ë³´ì. ì˜ ì¸ì‹ì´ ëœë‹¤ë©´ ì„±ê³µì´ë‹¤. 

# ì°¸ê³ 
[Ubuntuì—ì„œ ì¿ ë²„ë„¤í‹°ìŠ¤(k8s) ì„¤ì¹˜ ê°€ì´ë“œ](https://confluence.curvc.com/pages/releaseview.action?pageId=98048155)